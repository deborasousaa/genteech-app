<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDI por Colaborador - SalvaBras</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header class="main-header">
    <div class="logo">SALVABRAS</div>
    <nav>
      <a href="index.html">üè† In√≠cio</a>
      <a href="treinamentos.html">üìö Treinamentos</a>
      <a href="pdi.html">üìà PDIs</a>
      <a href="#">üë§ Meu Perfil</a>
    </nav>
  </header>

  <main class="container">
    <section class="welcome-section">
      <h2 class="section-title">Plano de Desenvolvimento Individual (PDI)</h2>
      <p>Escolha um colaborador ou digite o nome para gerenciar seus PDIs.</p>

      <div class="pdi-form">
        <label for="colaborador"><strong>Colaborador:</strong></label>
        <input type="text" id="colaborador" placeholder="Ex: Ana Souza" required />

        <hr style="margin: 20px 0;">

        <input type="text" id="objetivo" placeholder="Objetivo (ex: melhorar comunica√ß√£o)" required />
        <input type="text" id="acao" placeholder="A√ß√£o (ex: fazer curso de orat√≥ria)" required />
        <input type="text" id="prazo" placeholder="Prazo (ex: julho/2025)" required />
        <button type="submit" class="btn btn-orange" id="adicionarPDI">Adicionar PDI</button>
      </div>
    </section>

    <section>
      <h2 class="section-title">PDIs por Colaborador</h2>
      <div id="pdi-list" class="pdi-list"></div>
    </section>

    <section>
      <h2 class="section-title">üìå Exemplo Modelo - Ana Souza</h2>
      <div class="pdi-card">
        <h3>Melhorar Comunica√ß√£o Interpessoal</h3>
        <p><strong>A√ß√£o:</strong> Participar de curso de orat√≥ria e fazer simula√ß√µes em reuni√µes.</p>
        <p><strong>Prazo:</strong> Setembro/2025</p>
      </div>
      <div class="pdi-card">
        <h3>Dom√≠nio do Sistema ERP</h3>
        <p><strong>A√ß√£o:</strong> Realizar o curso completo do Protheus e apresentar melhorias.</p>
        <p><strong>Prazo:</strong> Outubro/2025</p>
      </div>
    </section>
  </main>

  <footer class="main-footer">
    <p><strong>SALVABRAS IND√öSTRIA E COM√âRCIO LTDA.</strong></p>
    <p>Links √öteis: <a href="#">Site Principal</a> | <a href="#">Pol√≠tica de Privacidade</a></p>
    <p>&copy; 2025 SalvaBras - Todos os direitos reservados.</p>
  </footer>

  <script>
    // ===================================================================
    // SCRIPT DA P√ÅGINA DE PDI - VERS√ÉO 3.0
    // Inclui funcionalidades de LER, CRIAR e DELETAR PDIs.
    // ===================================================================

    // --- Sele√ß√£o dos Elementos da P√°gina ---
    const pdiListContainer = document.getElementById('pdi-list');
    const colaboradorInput = document.getElementById('colaborador');
    const objetivoInput = document.getElementById('objetivo');
    const acaoInput = document.getElementById('acao');
    const prazoInput = document.getElementById('prazo');
    const addButton = document.getElementById('adicionarPDI');

    // --- Configura√ß√£o da API ---
    const API_URL = 'http://localhost:3000/api/pdis';

    // --- Fun√ß√µes da Aplica√ß√£o ---

    // Fun√ß√£o para LER os PDIs do servidor e mostrar na tela
    async function buscarErenderizarPDIs( ) {
        try {
            const response = await fetch(API_URL);
            const pdis = await response.json();

            pdiListContainer.innerHTML = '';

            pdis.forEach(pdi => {
                const pdiCard = document.createElement('div');
                pdiCard.className = 'pdi-card';
                pdiCard.innerHTML = `
                    <h3>${pdi.colaborador}</h3>
                    <p><strong>Objetivo:</strong> ${pdi.objetivo}</p>
                    <p><strong>A√ß√£o:</strong> ${pdi.acao || 'N√£o definida'}</p>
                    <p><strong>Prazo:</strong> ${pdi.prazo || 'N√£o definido'}</p>
                    <button class="btn btn-blue" onclick="removerPDI(${pdi.id})">Remover</button>
                `;
                pdiListContainer.appendChild(pdiCard);
            });

        } catch (error) {
            console.error('Erro ao buscar dados da API:', error);
            pdiListContainer.innerHTML = '<p style="color: red;">Erro ao carregar os dados. Verifique se o servidor est√° rodando.</p>';
        }
    }

    // Fun√ß√£o para CRIAR um novo PDI
    async function adicionarPDI() {
        const novoPDI = {
            colaborador: colaboradorInput.value,
            objetivo: objetivoInput.value,
            acao: acaoInput.value,
            prazo: prazoInput.value
        };

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(novoPDI)
            });

            if (response.ok) {
                colaboradorInput.value = '';
                objetivoInput.value = '';
                acaoInput.value = '';
                prazoInput.value = '';
                buscarErenderizarPDIs();
            } else {
                alert('Erro ao adicionar PDI.');
            }
        } catch (error) {
            console.error('Erro ao enviar dados para a API:', error);
            alert('Erro de comunica√ß√£o com o servidor.');
        }
    }

    // Fun√ß√£o para DELETAR um PDI
    async function removerPDI(pdiId) {
        if (!confirm('Tem certeza que deseja remover este PDI?')) {
            return;
        }

        try {
            const response = await fetch(`${API_URL}/${pdiId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                buscarErenderizarPDIs();
            } else {
                alert('Erro ao remover o PDI.');
            }
        } catch (error) {
            console.error('Erro ao comunicar com a API para remover:', error);
            alert('Erro de comunica√ß√£o com o servidor.');
        }
    }

    // --- "Ouvintes" de Eventos ---

    // Fica de olho no bot√£o "Adicionar"
    addButton.addEventListener('click', (event) => {
        event.preventDefault();
        adicionarPDI();
    });

    // --- Execu√ß√£o Inicial ---

    // Busca e mostra os PDIs assim que a p√°gina carrega
    buscarErenderizarPDIs();

  </script>

</body>
</html>
